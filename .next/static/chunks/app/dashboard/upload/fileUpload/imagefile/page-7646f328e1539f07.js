(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[463],{1676:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>F});var r=a(5155),s=a(2115),o=a(5695),n=a(7550),i=a(6671),l=a(3464),d=a(4995);let c="https://admin-api.pay.importa.biz/api",u=()=>{let[e,t]=(0,s.useState)(!1),[a,r]=(0,s.useState)(null),[o,n]=(0,s.useState)([]),{token:u}=(0,d.nc)(),[p,g]=(0,s.useState)(!1),m=(0,s.useCallback)(()=>u?{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer ".concat(u),"X-CSRF-TOKEN":""}:(console.error("No authentication token available"),{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":""}),[u]),f=(0,s.useCallback)(async()=>{t(!0),r(null);try{let e=m(),t=await l.A.get("".concat(c,"/categories"),{headers:e,withCredentials:!0,validateStatus:e=>e<500});if(401===t.status)throw Error("Session expired. Please log in again.");if(t.status>=400)throw Error("Failed to fetch categories: ".concat(t.status," ").concat(t.statusText));return Array.isArray(t.data)?t.data:[]}catch(s){var e,a;let t=(null==(a=s.response)||null==(e=a.data)?void 0:e.message)||"Failed to fetch categories";return r(t),i.oR.error(t),[]}finally{t(!1)}},[m]),h=(0,s.useCallback)(async()=>{if(!u)return n([]),t(!1),[];t(!0);try{let e=await f();return n(e),e}catch(e){throw console.error("Error in loadCategories:",e),n([]),e}finally{t(!1)}},[f,u]);return(0,s.useEffect)(()=>{let e=!0;return(async()=>{if(u&&!p)try{await h(),e&&g(!0)}catch(t){console.error("Failed to load categories:",t),e&&r("Failed to load categories. Please refresh the page.")}else!u&&e&&(g(!1),n([]))})(),()=>{e=!1}},[u,p,h]),{createCategory:async e=>{let a;t(!0),r(null);try{let t=m();a=i.oR.loading("Creating category...");let r=await l.A.post("".concat(c,"/categories"),{name:e},{headers:t,withCredentials:!0,validateStatus:e=>e<500});if(401===r.status)throw Error("Session expired. Please log in again.");if(r.status>=400){var s;throw Error((null==(s=r.data)?void 0:s.message)||"Failed to create category")}return i.oR.success("Category created successfully",{id:a}),await h(),r.data.data}catch(t){let e=t instanceof Error?t.message:"Failed to create category. Please try again.";return console.error("Error creating category:",t),a?i.oR.error(e,{id:a}):i.oR.error(e),r(e),(e.includes("Unauthenticated")||e.includes("Session expired")||e.includes("No authentication token"))&&localStorage.removeItem("token"),null}finally{t(!1)}},fetchCategories:f,categories:o,isLoading:e,error:a}};var p=a(6756),g=a(4416),m=a(3999);let f=p.bL,h=p.l9,x=e=>{let{children:t,...a}=e;return(0,r.jsx)(p.ZL,{...a,children:t})};x.displayName=p.ZL.displayName;let b=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(p.hJ,{ref:t,className:(0,m.cn)("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});b.displayName=p.hJ.displayName;let y=s.forwardRef((e,t)=>{let{className:a,children:s,...o}=e;return(0,r.jsxs)(x,{children:[(0,r.jsx)(b,{}),(0,r.jsxs)(p.UC,{ref:t,className:(0,m.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...o,children:[s,(0,r.jsxs)(p.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(g.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});y.displayName=p.UC.displayName;let v=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,m.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};v.displayName="DialogHeader";let j=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(p.hE,{ref:t,className:(0,m.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})});j.displayName=p.hE.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(p.VY,{ref:t,className:(0,m.cn)("text-sm text-muted-foreground",a),...s})}).displayName=p.VY.displayName;var N=a(7168);let w=s.forwardRef((e,t)=>{let{className:a,type:s,...o}=e;return(0,r.jsx)("input",{type:s,className:(0,m.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...o})});w.displayName="Input";var k=a(1154);function C(e){let{onCreateCategory:t,isCreating:a,children:o}=e,[n,i]=(0,s.useState)(!1),[l,d]=(0,s.useState)(""),[c,u]=(0,s.useState)(null),[p,g]=(0,s.useState)(!1);(0,s.useEffect)(()=>{p&&!a&&(d(""),u(null),i(!1)),g(a)},[a,p]);let m=async e=>{e.preventDefault(),l.trim()&&!a&&(u(null),await t(l.trim()))};return(0,r.jsxs)(f,{open:n,onOpenChange:e=>{e||(d(""),u(null)),i(e)},children:[(0,r.jsx)(h,{asChild:!0,children:o}),(0,r.jsxs)(y,{children:[(0,r.jsx)(v,{children:(0,r.jsx)(j,{children:"Add New Category"})}),(0,r.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{htmlFor:"category-name",className:"block text-sm font-medium text-muted-foreground",children:"Category Name"}),(0,r.jsx)(w,{id:"category-name",value:l,onChange:e=>d(e.target.value),placeholder:"Enter category name",disabled:a,required:!0}),c&&(0,r.jsx)("p",{className:"text-sm text-red-500",children:c})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,r.jsx)(N.$,{type:"button",variant:"outline",onClick:()=>i(!1),disabled:a,children:"Cancel"}),(0,r.jsx)(N.$,{type:"submit",disabled:a||!l.trim(),className:"min-w-[120px]",children:a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create Category"})]})]})]})]})}var S=a(4616);function E(e){let{selectedCategoryId:t,onCategoryChange:a,className:s="",onCreateCategory:o,isCreating:n=!1}=e,{categories:i,isLoading:l,error:d}=u();return(0,r.jsxs)("div",{className:"w-full space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("select",{value:(null==t?void 0:t.toString())||"",onChange:e=>a(e.target.value),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ".concat(s),disabled:l||n,children:[(0,r.jsx)("option",{value:"",children:l?"Loading categories...":"Select a category"}),i.map(e=>(0,r.jsx)("option",{value:e.id.toString(),children:e.name},e.id))]}),o&&(0,r.jsx)(C,{onCreateCategory:o,isCreating:n,children:(0,r.jsx)("button",{type:"button",disabled:l||n,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 w-10",children:n?(0,r.jsx)("span",{className:"h-4 w-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}):(0,r.jsx)(S.A,{className:"h-4 w-4"})})})]}),d&&(0,r.jsxs)("p",{className:"text-sm text-red-500",children:["Error loading categories: ",d]}),!l&&0===i.length&&!d&&(0,r.jsx)("p",{className:"text-sm text-yellow-600",children:"No categories available"}),l&&(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Loading categories..."})]})}var R=a(6766);function P(){let{token:e,user:t}=(0,d.nc)(),a=(0,o.useRouter)(),l=(0,o.useSearchParams)(),[c,p]=(0,s.useState)(null),{createCategory:g}=u(),[m,f]=(0,s.useState)(""),[h,x]=(0,s.useState)(""),[b,y]=(0,s.useState)(!1),[v,j]=(0,s.useState)(!1),[N,w]=(0,s.useState)(!1),[k,C]=(0,s.useState)(null),[S,P]=(0,s.useState)(null),[A,F]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(!e||!t)return void a.push("/blog")},[t,e,a]);let z=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?y(!0):"dragleave"===e.type&&y(!1)},D=(0,s.useCallback)(async()=>{try{let e=l.get("edit");if(e)try{let t=JSON.parse(decodeURIComponent(e));p({...t,isDraft:!1}),x(t.subtitle||""),f(t.category_id||""),t.image&&P(t.image.startsWith("http")?t.image:"https://admin-api.pay.importa.biz/storage/".concat(t.image)),w(!0)}catch(e){console.error("Error parsing edit data:",e),i.oR.error("Error loading post data"),a.push("/dashboard/upload/fileUpload");return}else{let e=localStorage.getItem("draftPost");if(e)p(JSON.parse(e));else{i.oR.error("No post data found"),a.push("/dashboard/upload/fileUpload");return}}}catch(e){console.error("Error loading data:",e),i.oR.error("Failed to load required data"),a.push("/dashboard/upload/fileUpload")}},[a,l]);(0,s.useEffect)(()=>{D()},[D]);let _=async(e,t)=>{try{F(!0);let a=!!await g(e);return a?(i.oR.success("Category created successfully"),t&&t()):i.oR.error("Failed to create category"),a}catch(e){return console.error("Error creating category:",e),i.oR.error("Error creating category"),!1}finally{F(!1)}},U=async r=>{if(r.preventDefault(),!c)return void i.oR.error("No post data found");if(!m)return void i.oR.error("Please select a category");if(!k&&!N)return void i.oR.error("Please select an image");j(!0);try{if(!e){i.oR.error("Authentication token not found. Please log in again."),a.push("/login");return}let r=N&&c.id?"https://admin-api.pay.importa.biz/api/posts/".concat(c.id):"https://admin-api.pay.importa.biz/api/posts",s=new FormData;if(k&&s.append("image",k),s.append("title",c.title),s.append("subtitle",h||""),s.append("content",c.content),s.append("category_id",m),s.append("is_published","1"),null==t?void 0:t.id)s.append("author_id",t.id.toString());else if(c.author_id)s.append("author_id",c.author_id.toString());else throw Error("User ID is required to create or update a post");let o=await fetch(r,{method:"POST",headers:{Accept:"application/json",Authorization:"Bearer ".concat(e)},body:s}),n=await o.json().catch(()=>({}));if(!o.ok)throw Error(n.message||"Failed to ".concat(N?"update":"publish"," post"));localStorage.removeItem("draftPost"),i.oR.success(N?"Post updated successfully!":"Post published successfully!"),a.push("/dashboard")}catch(t){let e=t instanceof Error?t.message:"Failed to ".concat(N?"update":"publish"," post");i.oR.error(e)}finally{j(!1)}};return(0,r.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[(0,r.jsxs)("button",{onClick:()=>a.back(),className:"flex items-center text-gray-600 hover:text-gray-900",children:[(0,r.jsx)(n.A,{className:"w-5 h-5 mr-2"}),"Back"]}),(0,r.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:N?"Update Post":"Publish Post"}),(0,r.jsx)("div",{className:"w-8"})]}),(0,r.jsxs)("div",{className:"max-w-6xl mx-auto p-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-8",children:"Publish post"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-base font-semibold text-gray-900 mb-4",children:"Cover photo"}),(0,r.jsx)("div",{className:"border-2 border-dashed rounded-xl p-16 text-center transition-colors ".concat(b?"border-purple-400 bg-purple-50":"border-gray-200 bg-gray-50"),onDragEnter:z,onDragLeave:z,onDragOver:z,onDrop:e=>{e.preventDefault(),e.stopPropagation(),y(!1);let t=e.dataTransfer.files;if(t&&t[0]){let e=t[0];C(e);let a=new FileReader;a.onloadend=()=>{P(a.result)},a.readAsDataURL(e)}},children:(0,r.jsxs)("div",{className:"space-y-4",children:[S?(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("div",{className:"relative w-full h-48",children:(0,r.jsx)(R.default,{src:S,alt:"Preview",fill:!0,className:"object-cover rounded-lg",sizes:"(max-width: 768px) 100vw, 50vw"})}),(0,r.jsx)("button",{type:"button",onClick:()=>{C(null),P(null)},className:"mt-2 text-sm text-red-600 hover:text-red-700",children:"Remove image"})]}):null,(0,r.jsxs)("p",{className:"text-gray-600 text-base",children:["Drag and drop here or"," ",(0,r.jsxs)("label",{className:"text-purple-600 hover:text-purple-700 font-medium underline cursor-pointer",children:["click here to browse",(0,r.jsx)("input",{type:"file",className:"hidden",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){let t=e.target.files[0];C(t);let a=new FileReader;a.onloadend=()=>{P(a.result)},a.readAsDataURL(t)}}})]})]}),k&&(0,r.jsxs)("div",{className:"mt-2 text-sm text-green-600",children:["Selected: ",k.name]}),(0,r.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-sm text-gray-500",children:[(0,r.jsx)("span",{children:"5:3 aspect ratio"}),(0,r.jsx)("span",{children:"â€¢"}),(0,r.jsx)("span",{children:"PNG or JPG or JPEG"})]})]})})]}),(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-gray-900 mb-4",children:"Category"}),(0,r.jsx)(E,{selectedCategoryId:m,onCategoryChange:e=>{f(e.toString())},className:"w-full",onCreateCategory:_,isCreating:A})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-base font-semibold text-gray-900 mb-4",children:"Preview subtitle"}),(0,r.jsx)("textarea",{value:h,onChange:e=>x(e.target.value),placeholder:"Enter preview subtitle here",rows:5,className:"w-full px-4 py-3 border border-gray-200 rounded-xl placeholder-gray-400 text-gray-700 resize-none focus:outline-none focus:border-purple-500 focus:ring-1 focus:ring-purple-500"})]})]})]}),(0,r.jsxs)("div",{className:"mt-12 flex justify-between items-center",children:[(0,r.jsx)("button",{type:"button",onClick:()=>a.back(),className:"text-gray-600 hover:bg-gray-100 hover:text-gray-800 px-4 py-2 rounded-lg font-medium transition-colors",children:"Back to Edit"}),(0,r.jsx)("button",{type:"button",onClick:U,disabled:v,className:"w-[50%] flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white transition-colors ".concat(v?"bg-indigo-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 cursor-pointer"),children:v?N?"Updating...":"Publishing...":N?"Update":"Publish"})]})]})]})}function A(){return(0,r.jsx)("div",{className:"min-h-screen bg-white flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading publish page..."})]})})}function F(){return(0,r.jsx)(s.Suspense,{fallback:(0,r.jsx)(A,{}),children:(0,r.jsx)(P,{})})}},3999:(e,t,a)=>{"use strict";a.d(t,{cn:()=>o});var r=a(2596),s=a(9688);function o(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}},4531:(e,t,a)=>{Promise.resolve().then(a.bind(a,1676))},4995:(e,t,a)=>{"use strict";a.d(t,{nc:()=>o});var r=a(5453),s=a(6786);let o=(0,r.v)()((0,s.Zr)(e=>({user:null,token:null,isAuthenticated:!1,setUser:t=>e({user:t,isAuthenticated:!!t}),setToken:t=>e({token:t}),logout:()=>e({user:null,token:null,isAuthenticated:!1})}),{name:"auth-storage",storage:(0,s.KU)(()=>localStorage)}))},7168:(e,t,a)=>{"use strict";a.d(t,{$:()=>l});var r=a(5155);a(2115);var s=a(9708),o=a(2085),n=a(3999);let i=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function l(e){let{className:t,variant:a,size:o,asChild:l=!1,...d}=e,c=l?s.DX:"button";return(0,r.jsx)(c,{"data-slot":"button",className:(0,n.cn)(i({variant:a,size:o,className:t})),...d})}}},e=>{var t=t=>e(e.s=t);e.O(0,[287,336,464,946,441,684,358],()=>t(4531)),_N_E=e.O()}]);